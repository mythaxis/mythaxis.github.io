{{/* Combine Hugo pages and xway2 data into content listing dictionary */}}
{{ $allStories := slice }}
{{ range (where .Site.Pages ".Type" "stock") }}
  {{ $currSection := .Section | default (urlize .Site.Params.currentIssue) }}
  {{ $currSection := .Site.GetPage "section" (print $currSection "/__index.md") }}
  {{ $story := dict
      "title" .Title
      "relurl" .RelPermalink
      "author" (collections.Delimit .Params.authors " and ")
      
      "issue"  (print .Params.issue " - " $currSection.Params.subhead)
      "number" (index (strings.FindRE `\d+?$` .Params.issue) 0)
      "order" .Params.weight
      "date" (.Params.publishDate.Format "January 2006")
  }}
  {{ $allStories = $allStories | append $story }}
{{ end }}
{{ $allStories = $allStories | append (index .Site.Data "xway2-metadata") }}



<!DOCTYPE HTML>
<html lang='{{ .Site.Language.Lang | default "en-us" }}'>
  {{ partial "htmlhead" . }}
  
  <body lang='{{ .Site.Language.Lang | default "en-us" }}' class="is-preload">
    <!-- Wrapper -->
    <div id="wrapper">
      {{ partial "header" . }}
      {{ partial "nav" . }}

      <!-- Main -->
      <div id="main">
        <section class="post">
            <header class="major">
              <img src="{{ "/images/toplist.svg" | safeURL }}" />
              <h1>{{ .Title }}</h1>
              <p>{{ .Description }}</p>
            </header>

            <p>
              {{ with .Site.GetPage "/archive.html" }}
                <a href='{{ .RelPermalink | relURL }}'><- Back to archives</a>
              {{ end }} | 
              {{ with .Site.GetPage "/catalogue.html" }}
                <a href='{{ .RelPermalink | relURL }}'>On to catalogue -></a>
              {{ end }}
            </p>

            {{ .Content }}


<table>
  <tbody class="scroll">
    {{ range (sort $allStories "title" "asc") }}
    <tr>
      <td><a href="{{ .relurl | relURL }}">{{ .title }}</a> by {{ .author }}</td>
    </tr>  
    {{ end }}
  </tbody>
</table>

Total number of published stories: {{ len $allStories }}<br/>



            <p>
              {{ with .Site.GetPage "/archive.html" }}
                <a href='{{ .RelPermalink | relURL }}'><- Back to archives</a>
              {{ end }} | 
              {{ with .Site.GetPage "/catalogue.html" }}
                <a href='{{ .RelPermalink | relURL }}'>On to catalogue -></a>
              {{ end }}
            </p>



        </section>
      </div>
      
      {{ partial "copyright" . }}
      <a href="#navPanel" id="navPanelToggle">{{ i18n "NAV_MENU" . }}</a>
    </div>

    {{ template "_internal/google_analytics.html" . }}
    {{ partial "scripts/index" . }}
  </body>
</html>